{"version":3,"file":"index.modern.js","sources":["../src/lib/OpenCvProvider.tsx","../src/lib/useOpenCv.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport * as React from 'react';\n\nconst OpenCvContext = React.createContext({ loaded: false, cv: undefined });\n\nconst { Consumer: OpenCvConsumer, Provider } = OpenCvContext;\n\nexport { OpenCvConsumer, OpenCvContext };\n\nconst scriptId = 'opencv-react';\nconst moduleConfig = {\n  wasmBinaryFile: 'opencv_js.wasm',\n  usingWasm: true,\n  onRuntimeInitialized: () => {},\n};\n\nexport const OpenCvProvider = ({\n  openCvVersion = '4.7.0',\n  openCvPath = '',\n  children,\n}: {\n  openCvVersion?: string;\n  openCvPath?: string;\n  children: React.ReactNode;\n}) => {\n  const [cvInstance, setCvInstance] = React.useState({\n    loaded: false,\n    cv: undefined,\n  });\n\n  React.useEffect(() => {\n    // @ts-ignore\n    if (document.getElementById(scriptId) || window.cv) {\n      return;\n    }\n\n    // https://docs.opencv.org/3.4/dc/de6/tutorial_js_nodejs.html\n    // https://medium.com/code-divoire/integrating-opencv-js-with-an-angular-application-20ae11c7e217\n    // https://stackoverflow.com/questions/56671436/cv-mat-is-not-a-constructor-opencv\n    moduleConfig.onRuntimeInitialized = () => {\n      // @ts-ignore\n      setCvInstance({ loaded: true, cv: window.cv });\n    };\n    // @ts-ignore\n    window.Module = moduleConfig;\n\n    const generateOpenCvScriptTag = () => {\n      const js = document.createElement('script');\n      js.id = scriptId;\n      js.src = openCvPath || `https://docs.opencv.org/${openCvVersion}/opencv.js`;\n\n      js.nonce = 'true';\n      js.defer = true;\n      js.async = true;\n\n      return js;\n    };\n\n    document.body.appendChild(generateOpenCvScriptTag());\n  }, [openCvPath, openCvVersion]);\n\n  return <Provider value={cvInstance}>{children}</Provider>;\n};\n","import * as React from 'react';\n\nimport { OpenCvContext } from './OpenCvProvider';\n\nexport const useOpenCv = () => React.useContext(OpenCvContext);\n"],"names":["OpenCvContext","React","loaded","cv","undefined","OpenCvConsumer","Consumer","Provider","moduleConfig","wasmBinaryFile","usingWasm","onRuntimeInitialized","OpenCvProvider","_ref","openCvVersion","_ref$openCvVersion","_ref$openCvPath","openCvPath","children","_React$useState","cvInstance","setCvInstance","js","document","getElementById","window","Module","body","appendChild","createElement","id","src","nonce","defer","async","value","useOpenCv"],"mappings":"sGAGM,IAAAA,EAAgBC,EAAoB,CAAEC,QAAQ,EAAOC,QAAIC,IAE7CC,EAA6BL,EAAvCM,SAA0BC,EAAaP,EAAbO,SAK5BC,EAAe,CACnBC,eAAgB,iBAChBC,WAAW,EACXC,qBAAsB,cAGXC,EAAiB,SAAHC,WACzBC,cAAAA,WAAaC,EAAG,QAAOA,EAAAC,EAAAH,EACvBI,WAAAA,WAAUD,EAAG,GAAEA,EACfE,EAAQL,EAARK,SAMAC,EAAoClB,EAAe,CACjDC,QAAQ,EACRC,QAAIC,IAFCgB,EAAUD,KAAEE,EAAaF,KAoChC,OA/BAlB,EAAgB,WAgBd,IACQqB,EAfJC,SAASC,eAvBA,iBAuB4BC,OAAOtB,KAOhDK,EAAaG,qBAAuB,WAElCU,EAAc,CAAEnB,QAAQ,EAAMC,GAAIsB,OAAOtB,MAG3CsB,OAAOC,OAASlB,EAchBe,SAASI,KAAKC,cAXNN,EAAKC,SAASM,cAAc,WAC/BC,GAvCQ,eAwCXR,EAAGS,IAAMd,8BAAyCH,eAElDQ,EAAGU,MAAQ,OACXV,EAAGW,OAAQ,EACXX,EAAGY,OAAQ,EAEJZ,MAIR,CAACL,EAAYH,IAETb,EAACM,GAAS4B,MAAOf,GAAaF,ICzD1BkB,EAAY,kBAAMnC,EAAiBD"}